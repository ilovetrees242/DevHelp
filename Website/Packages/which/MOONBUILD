#!/bin/bash
MOONPKGNAME="which"
MOONPKGVERSION="2.23"
MOONPKG="$MOONPKGNAME-$MOONPKGVERSION"
DEPENDS="bash glibc"
BUILDSCRIPTPID=""
case $1 in
	chkdeps)
        echo -e "${YELLOW}Checking for dependencies...${NC}"
        $(echo $DEPENDS | awk '{print $1}') --version &> /dev/null
		if [ $? -ne 127 ]; then
            echo -e "${YELLOW}Dependency ${ORANGE}$(echo $DEPENDS | awk '{print $1}')${YELLOW} not found!${NC}"
			exit 1
		fi
        if [ $(echo $DEPENDS | awk '${print $2}') == "glibc" ]; 
            then ldd --version &> /dev/null 
		    if [ $? -eq 127 ]; then
                echo -e "${YELLOW}Dependency ${ORANGE}$(echo $DEPENDS | awk '{print $2}')${YELLOW} not found!${NC}"
    			exit 1
	    	fi
        fi
        echo -e "${YELLOW}Dependencies met!${NC}"
	;;
	build)
        if [ "$VEILERQUIET" -eq 0 ]; then
            echo -e "${YELLOW}Extracting the package source tarball...${NC}"; sleep 0.2
		    tar xvf $MOONPKG.tar.?z && echo -e "${WHITE}->Done!${NC}"
            echo -e "${YELLOW}Entering build enviroment...${NC}"; sleep 0.2
		    pushd $MOONPKG && echo -e "${WHITE}->Done!${NC}"
                echo -e "${YELLOW}Configuring the package...${NC}"; sleep 0.2
			    ./configure --prefix=/usr && echo -e "${WHITE}->Done!${NC}"
                echo -e "${YELLOW}Building the package...${NC}"; sleep 0.2
                make && echo -e "${WHITE}->Done!${NC}"
            popd
        else
            while true; do
                echo -ne "\r${YELLOW}Extracting the package source tarball   ${NC}"; sleep 0.2
                echo -ne "\r${YELLOW}Extracting the package source tarball.  ${NC}"; sleep 0.2
                echo -ne "\r${YELLOW}Extracting the package source tarball.. ${NC}"; sleep 0.2
                echo -ne "\r${YELLOW}Extracting the package source tarball...${NC}"; sleep 0.2
            done &
            BUILDSCRIPTPID="$!"
            tar xf $MOONPKG.tar.?z && kill $BUILDSCRIPTPID && echo -e "\n${WHITE}->Done!${NC}"
            echo -e "${YELLOW}Entering build enviroment...${NC}"; sleep 0.2
		    pushd $MOONPKG &> /dev/null && echo -e "->${WHITE}Done!${NC}"
                while true; do
                    echo -ne "\r${YELLOW}Configuring ${WHITE}$MOONPKGNAME   ${NC}"; sleep 0.2
                    echo -ne "\r${YELLOW}Configuring ${WHITE}$MOONPKGNAME.  ${NC}"; sleep 0.2
                    echo -ne "\r${YELLOW}Configuring ${WHITE}$MOONPKGNAME.. ${NC}"; sleep 0.2
                    echo -ne "\r${YELLOW}Configuring ${WHITE}$MOONPKGNAME...${NC}"; sleep 0.2
                done &
                BUILDSCRIPTPID="$!"
                ./configure --prefix=/usr &> /dev/null && kill $BUILDSCRIPTPID && echo -e "\n${WHITE}->Done!${NC}"
                while true; do
                    echo -ne "\r${YELLOW}Compiling ${WHITE}$MOONPKGNAME${YELLOW}   ${NC}"; sleep 0.2
                    echo -ne "\r${YELLOW}Compiling ${WHITE}$MOONPKGNAME${YELLOW}.  ${NC}"; sleep 0.2
                    echo -ne "\r${YELLOW}Compiling ${WHITE}$MOONPKGNAME${YELLOW}.. ${NC}"; sleep 0.2
                    echo -ne "\r${YELLOW}Compiling ${WHITE}$MOONPKGNAME${YELLOW}...${NC}"; sleep 0.2
                done &
                BUILDSCRIPTPID="$!"
                make &> /dev/null && kill "$BUILDSCRIPTPID" && echo -e "\n${WHITE}->Done!${NC}"
            popd
        fi
	;;
    install)
        if [ $VEILERQUIET -eq 0 ]; then
            echo -e "${YELLOW}Installing ${WHITE}${MOONPKGNAME}...${NC}"; sleep 0.2
            pushd $MOONPKG
            make install && echo -e "${WHITE}->Done!${NC}"
            popd
            echo -e "${YELLOW}Cleaning up...${NC}"; sleep 0.2
            rm -rfv $MOONPKG $MOONPKG.* && echo -e "${WHITE}->Done!${NC}"
        else
            while true; do
                echo -ne "\r${YELLOW}Installing ${WHITE}$MOONPKGNAME   ${NC}"; sleep 0.2
                echo -ne "\r${YELLOW}Installing ${WHITE}$MOONPKGNAME.  ${NC}"; sleep 0.2
                echo -ne "\r${YELLOW}Installing ${WHITE}$MOONPKGNAME.. ${NC}"; sleep 0.2
                echo -ne "\r${YELLOW}Installing ${WHITE}$MOONPKGNAME...${NC}"; sleep 0.2
            done &
            BUILDSCRIPTPID="$!"
            pushd $MOONPKG &> /dev/null
            make install &> /dev/null && kill $BUILDSCRIPTPID && echo -e "\n${WHITE}->Done!${NC}"
            while true; do
                echo -ne "\r${YELLOW}Cleaning up   ${NC}"; sleep 0.2
                echo -ne "\r${YELLOW}Cleaning up.  ${NC}"; sleep 0.2
                echo -ne "\r${YELLOW}Cleaning up.. ${NC}"; sleep 0.2
                echo -ne "\r${YELLOW}Cleaning up...${NC}"; sleep 0.2
            done &
            BUILDSCRIPTPID="$!"
            popd
            rm -rf "$MOONPKG" "$MOONPKG.tar.gz" && kill $BUILDSCRIPTPID && echo -e "\n${WHTIE}->Done!${NC}"
        fi
    ;;
	uninstall)
        if [ $VEILERQUIET -eq 1 ]; then
            while true; do
                echo -ne "\r${YELLOW}Uninstalling ${WHITE}${MOONPKGNAME}${YELLOW}   "; sleep 0.2
                echo -ne "\r${YELLOW}Uninstalling ${WHITE}${MOONPKGNAME}${YELLOW}.  "; sleep 0.2
                echo -ne "\r${YELLOW}Uninstalling ${WHITE}${MOONPKGNAME}${YELLOW}.. "; sleep 0.2
                echo -ne "\r${YELLOW}Uninstalling ${WHITE}${MOONPKGNAME}${YELLOW}..."; sleep 0.2
            done &
            BUILDSCRIPTPID=$!
		    rm /usr/bin/which
		    rm -rf /usr/share/man/man1/which.1 && kill "$BUILDSCRIPTPID" && echo -e "\n${WHITE}->Done!${NC}"
        else
            echo -ne "${YELLOW}Uninstalling ${WHITE}${MOONPKGNAME}${YELLOW}..."
            rm /usr/bin/which
            rm -rf /usr/share/man/man1/which.1 && echo -e "\n${WHITE}->Done!${NC}"
        fi
	;;
esac
