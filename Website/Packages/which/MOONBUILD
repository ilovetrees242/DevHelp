#!/bin/sh
MOONPKGNAME="which"
MOONPKGVERSION="2.23"
MOONPKG="$MOONPKGNAME-$MOONPKGVERSION"
MOONPKGREPO="https://ilovetrees242.github.io/DevHelp/Website/Packages"
DEPENDS="bash glibc"
BUILDSCRIPTPID=""
case $1 in
	chkdeps)
        $(echo $DEPENDS | awk '{print $1}') --version
		if [ $? -ne 0 ]; then
            echo "${YELLOW}Dependency ${ORANGE}$(echo $DEPENDS | awk '{print $1}')${YELLOW} not found!${NC}"
			exit 1
		fi
        GLIBC=$(readelf -d $(find /usr -name "libc.so.6") | grep "soname" | awk '{print $5}')
		if [ "$GLIBC" != "[libc.so.6]" ]; then
            echo "${YELLOW}Dependency ${ORANGE}$(echo $DEPENDS | awk '{print $2}')${YELLOW} not found!${NC}"
			exit 1
		fi
	;;
	build)
        if [ "$VEILERQUIET" -eq 0 ]; then
            echo -e "${YELLOW}Extracting the package source tarball...${NC}"; sleep 0.2
		    tar xvf $MOONPKG.tar.?z && echo -e "${WHITE}->Done!${NC}"
            echo -e "${YELLOW}Entering build enviroment...${NC}"; sleep 0.2
		    pushd $MOONPKG && echo -e "${WHITE}->Done!${NC}"
                echo -e "${YELLOW}Configuring the package...${NC}"; sleep 0.2
			    ./configure --prefix=/usr && echo -e "${WHITE}->Done!${NC}"
                echo -e "${YELLOW}Building the package...${NC}"; sleep 0.2
                make && echo -e "${WHITE}->Done!${NC}"
        else
            while true; do
                echo -e "${YELLOW}Extracting the package source tarball   ${NC}"; sleep 0.2
                echo -e "${YELLOW}Extracting the package source tarball.  ${NC}"; sleep 0.2
                echo -e "${YELLOW}Extracting the package source tarball.. ${NC}"; sleep 0.2
                echo -e "${YELLOW}Extracting the package source tarball...${NC}"; sleep 0.2
            done &
            BUILDSCRIPTPID="$!"
            tar xf $MOONPKG.tar.?z && kill $BUILDSCRIPTID && echo -e "${WHITE}->Done!${NC}"
            echo -e "${YELLOW}Entering build enviroment...${NC}"; sleep 0.2
		    pushd $MOONPKG && echo -e "->${WHITE}Done!{NC}"
                while true; do
                    echo -e "${YELLOW}Configuring ${WHITE}$LFSPKGNAME   ${NC}"; sleep 0.2
                    echo -e "${YELLOW}Configuring ${WHITE}$LFSPKGNAME.  ${NC}"; sleep 0.2
                    echo -e "${YELLOW}Configuring ${WHITE}$LFSPKGNAME.. ${NC}"; sleep 0.2
                    echo -e "${YELLOW}Configuring ${WHITE}$LFSPKGNAME...${NC}"; sleep 0.2
                done &
                BUILDSCRIPTPID="$!"
                ./configure --prefix=/usr &> /dev/null && kill $BUILDSCRIPTPID && echo -e "${WHITE}->Done!${NC}"
                while true; do
                    echo -e "${YELLOW}Compiling ${WHITE}$LFSPKGNAME${YELLOW}   ${NC}"; sleep 0.2
                    echo -e "${YELLOW}Compiling ${WHITE}$LFSPKGNAME${YELLOW}.  ${NC}"; sleep 0.2
                    echo -e "${YELLOW}Compiling ${WHITE}$LFSPKGNAME${YELLOW}.. ${NC}"; sleep 0.2
                    echo -e "${YELLOW}Compiling ${WHITE}$LFSPKGNAME${YELLOW}...${NC}"; sleep 0.2
                done &
                BUILDSCRIPTPID="$!"
                make &> /dev/null && kill "$BUILDSCRIPTPID" && echo -e "${WHITE}->Done!${NC}"
        fi
	;;
    install)
        if [ $VEILERQUIET -eq 0 ]; then
            echo -e "${YELLOW}Installing ${WHITE}$LFSPKGNAME...${NC}"; sleep 0.2
            pushd $MOONPKG
            make install && echo -e "${WHITE}->Done!${NC}"
            popd
            echo -e "${YELLOW}Cleaning up...${NC}"; sleep 0.2
            rm -rfv $LFSPKGNAME $LFSPKGNAME.* && echo -e "${WHITE}->Done!${NC}"
        else
            while true; do
                echo -e "${YELLOW}Compiling ${WHITE}$LFSPKGNAME   ${NC}"; sleep 0.2
                echo -e "${YELLOW}Compiling ${WHITE}$LFSPKGNAME.  ${NC}"; sleep 0.2
                echo -e "${YELLOW}Compiling ${WHITE}$LFSPKGNAME.. ${NC}"; sleep 0.2
                echo -e "${YELLOW}Compiling ${WHITE}$LFSPKGNAME...${NC}"; sleep 0.2
            done &
            BUILDSCRIPTPID="$!"
            pushd $MOONPKG &> /dev/null
            make install &> /dev/null && kill $BUILDSCRIPTPID && echo -e "${WHITE}->Done!${NC}"
            while true; do
                echo -e "${YELLOW}Cleaning up   ${NC}"; sleep 0.2
                echo -e "${YELLOW}Cleaning up.  ${NC}"; sleep 0.2
                echo -e "${YELLOW}Cleaning up.. ${NC}"; sleep 0.2
                echo -e "${YELLOW}Cleaning up...${NC}"; sleep 0.2
            done &
            popd
            rm -rf $LFSPKGNAME $LFSPKGNAME.* && echo -e "${WHTIE}->Done!${NC}"
        fi
    ;;
	uninstall)
        while true; do
            echo -e "${YELLOW}Uninstalling ${WHITE}${LFSPKGNAME}${YELLOW}   "; sleep 0.2
            echo -e "${YELLOW}Uninstalling ${WHITE}${LFSPKGNAME}${YELLOW}.  "; sleep 0.2
            echo -e "${YELLOW}Uninstalling ${WHITE}${LFSPKGNAME}${YELLOW}.. "; sleep 0.2
            echo -e "${YELLOW}Uninstalling ${WHITE}${LFSPKGNAME}${YELLOW}..."; sleep 0.2
        done &
        BUILDSCRIPTPID="$!"
		rm /usr/bin/which
		rm -rf /usr/share/man/man1/which.1 && kill "$BUILDSCRIPTID" && echo -e "${WHITE}->Done!${NC}"
	;;
esac
